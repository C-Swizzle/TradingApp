<nav class="black" role="navigation">
    <div class="nav-wrapper container"><a id="logo-container" href="/" class="brand-logo"
        style="font-family: Deftone-Stylus; color: whitesmoke;">The Cart & Disc</a>
      <ul class="right hide-on-med-and-down">
        {{!-- {{!-- <li><a href="./signup.html">Sign Up</a></li> --!}} --}}
        <div class="valign-wrapper">
        <li>Welcome {{firstName}} {{lastName}}!</li>
        <li><a href="#"><i class="fa fa-fw fa-thumbs-up" ></i> {{numberOfPositiveRatings}}</a></li> 
        <li><a href="#"><i class="fa fa-fw fa-thumbs-down" ></i> {{numberOfNegativeRatings}}</a></li> 
        <li>
          <a class="waves-effect waves-light btn-small" href="/list-game">List a game</a>

        </li>
        <li>
          <a class="waves-effect waves-light btn-small" href="/logout">Logout</a>

        </li>

        <li><a href="#">Credits: {{credits}} </a></li> 
        </div>
      </ul>

      <ul id="nav-mobile" class="sidenav">
        <li><a href="./signup.html">Sign Up</a></li>
        <li><a href="#">Log In</a></li>
        <br>
        <li><a href="#">Recently Added</a></li>
        <li><a href="#">Nintendo Switch</a></li>
        <li><a href="#">XBOX one</a></li>
        <li><a href="#">PS4</a></li>
        <li><a href="#">Nintendo 3DS</a></li>
      </ul>
      <a href="#" data-target="nav-mobile" class="sidenav-trigger"><i class="material-icons">menu</i></a>
    </div>
  </nav>
  <div class="nav-wrapper">
    <form>
          <div class="input-field">
            <input id="search" type="search" required>
            <label class="label-icon" for="search"><i class="material-icons">search</i></label>
            <i class="material-icons">close</i>
          </div>
        </form>
  </div>
  <div class="container">
    <div id="search-results" style="display:none">
      Search Results: 

    </div></div>
  <div class="container"id="current"><div class="container"><div class="h1">Your Current Offers:</div></div>
  
  
  
  {{#each salesData}}
  {{#unless soldBoolean}}
  {{#unless inTransaction}}
  <div class="row">
    <div class="col s12 m6">
      <div class="card blue-grey darken-1">
        <div class="card-content white-text">
          <span class="card-title">{{name}}</span>
          <p>Price: {{price}} credits</p>
          <p>
            {{#if condition}}
            Condition: {{condition}}
            {{else}}
            You haven't specified the condition of this item!
            {{/if}}
          </p>
          <p>
            {{#if description}}
            Description: {{description}}
            {{else}}
             You haven't given a description of this item!
            {{/if}}
          </p>

        </div>
        <div class="card-action">
         <a class="waves-effect waves-light btn-small del-button" data-id={{id}}>Delete this Post</a>
          {{!-- <a href="#" class="update-post">Update this Post</a> --}}
        </div>
      </div>
    </div>
  </div>
  {{/unless}}
  {{/unless}}
  {{/each}}

  
<div class="container" id="in-progress"><div class="h1">Your Transactions in Progress:</div>
 {{#each salesData}}
  {{#if inTransaction}}
  <div class="row">
    <div class="col s12 m6">
      <div class="card blue-grey darken-1">
        <div class="card-content white-text">
          <span class="card-title">{{name}}</span>
          <p>Price: {{price}} credits</p>
         
        </div>
        <div class="card-action">
          {{!-- <a class="waves-effect waves-light btn-small del-button" data-id={{id}}>Delete this Post</a> --}}
          {{!-- <a href="#">Update this Post</a> --}}
        </div>
      </div>
    </div>
  </div>
  {{/if}}
  {{/each}}
</div>

<div class="container" id="previous"><div class="h1">Your previous sales:</div>
 {{#each salesData}}
  {{#if soldBoolean}}
  <div class="row">
    <div class="col s12 m6">
      <div class="card blue-grey darken-1">
        <div class="card-content white-text">
          <span class="card-title">{{name}}</span>
          <p>Price: {{price}} credits</p>
          <p>Sold At: {{soldAtTime}} </p>

        </div>
        <div class="card-action">
          <a class="waves-effect waves-light btn-small del-button" data-id={{id}}>Delete this Post</a>
          {{!-- <a href="#">Update this Post</a> --}}
        </div>
      </div>
    </div>
  </div>
  {{/if}}
  {{/each}}
</div>
<div class="container" id="buy"><div class="h1">Your buy requests:</div>
 {{#each buyData}}
  
  <div class="row">
    <div class="col s12 m6">
      <div class="card blue-grey darken-1">
        <div class="card-content white-text">
          <span class="card-title">{{name}}</span>
          <p>Price: {{price}} credits</p>
          <p>Transaction started at: {{transactionStartedAtTime}} </p>

        </div>
        <div class="card-action">
          <a class="waves-effect waves-light btn-small feedback" data-id={{id}}>Give Feedback</a>
          {{!-- <a href="#">Update this Post</a> --}}
        </div>
      </div>
    </div>
  </div>
 
  {{/each}}
</div>

</div>


<div>


</div>






  <script>
$(document).ready(function(){
  $(document).keyup(function(event){
    event.preventDefault()
  })
  $("#submit").on("click",function(e){
    e.preventDefault();
  });
  $('form').keypress(function(event) { 
    if (event.keyCode===13){
      event.preventDefault();
      var searchQuery=$("#search").val().trim();
      console.log(searchQuery);
      $.ajax({method:"GET",url:"/api/sellOffers/query/"+searchQuery}).then(function(response){
        console.log(response);
        $("#search-results").css("display","inherit");
        for(var i=0;i<response.length;i++){
          var card =`<div class="row">
        <div class="col s12 m6">
          <div class="card blue-grey darken-1">
            <div class="card-content white-text">
              <span class="card-title">Name: ${response[i].name}</span>
              <p>Price: ${response[i].price}</p>
              <p>Condition: ${response[i].condition}</p>
              <p>Console: ${response[i].consoleType}</p>
        
            </div>
            <div class="card-action">
              <a href="#" class="buy-button" data-id=${response[i].id}>Buy this Game</a>
            </div>
            <div id=${response[i].id}></div>
          </div>
        </div>
      </div>`;
      $("#search-results").append(card);
        }
      })
    }
  
}); 
$(document).on("click",".del-button",function(){
  console.log("hit delete")
    console.log(this)
    var idToDel=$(this).data("id");
    console.log(idToDel);
    $.ajax({method:"DELETE",url:"/api/sellOffers/"+idToDel}).then(function(response){
      window.location.reload();
    })
  })  
//get the sell offers from the user
$(document).on("click",".buy-button",function(){
  console.log("hit buy")
    console.log(this)
    var idToBuy=$(this).data("id");
    console.log(idToBuy);
    $.ajax({method:"PUT",url:"/api/sellOffers/buy",data:{id:idToBuy}}).then(function(response){
      console.log(response);
      $("#"+idToBuy).append(response);
      if(response==="Success!"){
        $("#"+idToBuy).css("color","green");
      } else{
        $("#"+idToBuy).css("color","red");

      }
    })
  })  

});

</script>

